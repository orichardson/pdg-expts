\documentclass{article}


\input{pdg-preamble-v1}
\setlength\parskip{1ex}

\newcommand{\CI}{\mathbin{\bot\!\!\!\bot}}
\newcommand{\Pa}{\mathop{\mathbf{Pa}}}

\begin{document}
    
    \subsection*{Two Equivalent Definitions of Mechanism Independence}
    
    \begin{defn}
        Let $f : X_1 \to \Delta Y_1$ and $g : X_2 \to \Delta Y_2$ be mechanisms.
        We say $f$ and $g$ are independent in a joint distribution $\nu(X_1, X_2, Y_1, Y_2)$ iff
        \begin{enumerate}[nosep]
        \item $\nu(Y_1 \mid X_1) = f$,
        \item $\nu(Y_2 \mid X_2) = g$, and
        \item $\displaystyle Y_1 \underset\nu{\CI} Y_2 \mid X_1, X_2$.
            
        \end{enumerate}        
    \end{defn}
    
    \begin{claim}
        Given a function $f : X \to \Delta Y$, we can construct a ``derandomized'' function $\tilde f : X \times U \to Y$,
        such that 
        \begin{enumerate}[label=(\alph*),nosep]
            \item If $u \in U$ is chosen uniformly at random, then
                the resulting distribution $\tilde f(x, u)$ (a probability over $Y$) equals $f(x)$.  Symbolically:
            \[
                \tilde f^\#(x, \mathrm{Unif}(U)) = f(Y|x) \quad\text{for all } x \in X.
            \]
        \end{enumerate}
    \end{claim}   
    % \begin{proof}
    %     \textbf{(Assume X and Y are finite.)}. 
    % \end{proof}
    
    
    \begin{defn}
        Consider $f : X_1 \times U_1 \to Y_1$ and $g : X_2 \times U_2 \to Y_2$. 
        They are independent in $\nu(X_1, X_2, Y_1, Y_2, U_1, U_2)$
        iff $U_1$ and $U_1$ are independent in $\nu$, conditioned on $X_1$ and $X_2$. 
    \end{defn}
    
    
    \begin{prop}
        $f$ and $g$ are 
    \end{prop}
    
    
    \section{Compatibility with a Set of Type-1 Edges}
    \begin{defn}
        A joint distribution $\mu$ is qualitatively compatible (or q-compatible) with a collection of type-1
        edges
        $\Ed 
        %= \{ \ed {L}{X_L}{Y_L} \}%
        %_{L \in \mathrm{Labels}}
        $ iff
        \begin{enumerate}
            % \item for every pair of disjoint subsets of edges $E_1, E_2 \subset \Ed$, 
            % we have that
            % \[
            %     \Tgt E_1 \underset\mu\CI \Tgt E_2 ~\Big|~ \Src E_1 \cup \Src E_2
            % \]
            \item for every pair of distinct edges $e_1, e_2 \in \Ed$, 
            we have that
            \[
                \Tgt e_1 \underset\mu\CI \Tgt e_2 ~\Big|~ \Src e_1 \cup \Src e_2
            \]
        \end{enumerate}
    \end{defn}
    
    \begin{example}
        \begin{enumerate}[label=\textbf{(\alph*)}]
        \item Suppose $\Ed = \{ \ed1{}X, ~ \ed2{}X \}$ consists of just two edges pointing to $X$.
            Since there is only one pair of distinct edges edges,
            $\mu$ is q-compatible with $\Ed$ iff 
            \begin{align*}
                X \underset\mu\CI X \qquad\iff\qquad \mu(X) = \delta_x \text{ for some }x \in \V(X),
            \end{align*}
            since the only way for a random variable to be independent of itself is if it is deterministic.
            
        \item By the same logic, $\mu$ is q-compatible with $\{ \to\! X, ~Y \!\gets \}$ iff
            % $\mu(X,Y) = \mu(X)\mu(Y)$.                
            $X \CI_\mu Y$. 

        \item Generalizing the first example, 
        $\mu$ is q-compatible with 
        $\Ed = \{ \ed1{X\!}{\!Y}, ~ \ed2{X\!}{\!Y} \}$ 
        % $\Ed = [  ] 
        consisting of two parallel edges iff
        \begin{align*}
            Y \underset\mu\CI Y \mid X \qquad
            &\iff\qquad \mu(Y, Y, X) \mu(X) = \mu(Y, X)\mu(Y,X)
            % \\&\iff\qquad \mu(X) = \mu(Y,X) \text{ or } \mu(X,Y) = 0
            \\&\iff\qquad \mu(X,Y) \in \{\mu(X), 0\}
            \\&\iff\qquad\text{the value of $Y$ is fully determined by $X$ in $\mu$}
            \\&\iff\qquad \H_{\mu}(Y|X) = 0            
        \end{align*}
        
        \end{enumerate}
    \end{example}
    
    
    \begin{example}
        Consider $\Ed = \{ \ed 1{}{\!X},~ \ed2{Y\!}{\!X} \}$.
        A distribution $\mu$ is q-compatible with $\Ed$ iff
        \[
            X \underset\mu\CI X \mid Y \quad\iff\quad \text{$X$ is a function of $Y$}
            \quad\iff\quad \H_\mu(X|Y) = 0
        \] 
    \end{example}
    
    \begin{remark}
        From the above, we can see that our definition does not distinguish between the qualitative PDGs
        \vspace{-2ex}
        \[
            \begin{tikzpicture}[center base]
                \node[dpad0] (X) {$X$};
                \node[dpad0,right=0.6 of X] (Y) {$Y$};
                \draw[arr2] (X) -- (Y);
                \draw[arr2, <-] (Y) -- ++(1, 0);
            \end{tikzpicture}
            \quad~ \text{and}\qquad
            \begin{tikzpicture}[center base]
                \node[dpad0] (X) {$X$};
                \node[dpad0,right=0.6 of X] (Y) {$Y$};
                \draw[arr2] (X) to[bend left] (Y);
                \draw[arr2] (X) to[bend right] (Y);
            \end{tikzpicture}
            ~.
        \]
    \end{remark}
    
    % \begin{example}
    %     A joint distribution $\mu$ is  q-compatible with the edges of a BN iff
    %     \begin{align*}
    % 
    %     \end{align*}
    % \end{example}
    \begin{prop}
        A joint distribution $\mu$ is q-compatible with the edges corresponding to the structure of qualitative BN $\mathcal G$%
            \footnote{that is, the edges of the PDG $\PDGof{\mathcal B}$ for a BN $\mathcal B$}
        iff it satisfies the independencies of $\mathcal G$.
                % {\color{red} False!}
    \end{prop}
    \begin{proof}
        % {\color{red} False!}
        $(\implies)$. Suppose that $\mu$ satisfies the independencies of $\mathcal B$.
        Recall that in a BN structure, there is a 1-1 correspondence between hyper-edges $\Ed$ of $\cal B$ and the variables of $\cal B$. 
        So, let $X,Y$ be two variables of $\cal B$.
        
        To show that $\mu$ is q-compatible with $\Ed$, it suffices to show that 
        \[ X \underset\mu\CI  Y ~\Big|~ \Pa( X) \cup \Pa( Y)
            % \qquad\text{---which we do in the appendix}
            . \]
        % By RaU Thm 4.4.4 (CIRV3), it suffices to show
        % \[ \mat X \underset\mu\CI \mat Y \cup \Pa(\mat Y) ~\Big|~ \Pa(\mat X) \]
        This can be proved by appeal to d-separation. 
        Suppose, for contradiction, that $X$ and $Y$ are not d-separated given $\Pa( X)$ and $\Pa(Y)$,
         % i.e., there are variables $X \in \ X$ and $Y \in \mat Y$ that are d-connected given $\Pa(\mat X)$ and $\Pa(\mat Y)$.
        i.e., they are d-connected.
        By definition, this means that there is an undirected path (of edges of $\cal B$) that (1) cannot include parents of $X$ or $Y$ and (2) can only include head-to-head connections of directed edges $\cdots \to Z\gets \cdots$ at those nodes $Z$ which have a parent of $X$ or $Y$ descendent. 
        
        Now, because this path includes neither any parents of $X$ nor $Y$, the edges at the ends of the path must point inwards; the directions of the first and last edges must be: $X \to \cdots \gets Y$. 
        Such a path must necessarily have a head-to-head connection somewhere;
        %---let's call it $Z$---
        let's call $Z_1$ the node closest to $X$ at which this occurs, and analogously, let's call $Z_2$ the closest such node to $Y$.
        By the criteria for d-separatedness, every such node must have a parent of $X$ or $Y$ as a descendent (which we'll call $W_1$ and $W_2$ respectively, for $Z_1$ and $Z_2$). 
        % Without loss of generality, suppose it's a parent of $X$. 
        But this contradicts the fact that $\cal B$ is an acyclic graph! 
        
        Concretely, it must be the case that $W_1$ is not a parent of $X$ (so it is a parent of $Y$), and $W_2$ is not a parent of $Y$ (so it is a parent of $X$). 
        Because if $W_1$ were a parent of $X$, we would have a directed cycle 
        $W_1 \to X \to\cdots\to Z_1 \to \cdots \to W_1,$ 
        and if $W_2$ were a parent of $Y$, we would analogously have the directed cycle 
        $W_2 \to Y \to\cdots\to Z_2 \to \cdots\to W_2$. 
        But we're still in a bind; the only way to prevent this was to have edges $W_2 \to X$ and $W_1 \to Y$, creating the larger directed cycle
        \[
            W_2 \to X \to\!\cdots\!\to Z_1 \to\!\cdots\!\to W_1 \to Y \to\!\cdots\!\to Z_2 \to\!\cdots\!\to W_2.
        \]
        
        % Suppose that there is an undirected path from some $X \in \mat X$ to some $Y \in \mat Y$. Then

        
                
        $(\impliedby)$.
    \end{proof}
    \begin{remark}
        This is not true if we strengthened qualitative consistency to require independence for \textbf{every} disjoint subset of edges (as opposed to just the singletons as we do now)! Counter-example:
        \begin{center}
        \begin{tikzcd}[column sep=1em,row sep=1.5ex]
            X_1 \to \cdots \ar[r] & Z \ar[d] & \ar[l] \cdots \gets Y \\
            & \vdots \ar[d] & \\
            X_2 & \ar[l] W
        \end{tikzcd}
        \end{center}
        In the above BN, it's not the case that
        \(
            \{X_1, X_2\} \CI_{\cal B} Y ~\big|~ W.
        \)
    \end{remark}
    
    
    \begin{claim}
        A distribution $\mu$ is qualitatively compatible with the edges of an unweighted PDG $\dg N$ iff 
        % $\IDef{\dg N}(\mu) \succeq 0$. 
        the information profile vector
    \end{claim}
    
\end{document}
