\documentclass{article}


\input{pdg-preamble-v1}
\setlength\parskip{1ex}

\newcommand{\CI}{\mathbin{\bot\!\!\!\bot}}
\newcommand{\Pa}{\mathop{\mathbf{Pa}}}

\begin{document}

\begin{defn}
    Suppose $X$ and $Y$ are variables.
    A pair $(f, d)$, where $f : \V\!X \times U \to \V Y$ and $d : \Delta U$,
    is said to be a \emph{de-randomization} of a cpd $p(Y|X)$ iff, for each $x, y \in \V(X,Y)$, we have that 
    \[
        \Pr_{u\sim d} [ f(x, u) = y] = p(Y{=}y\mid X{=}x).
        \qedhere
    \]
\end{defn}

\section{Compatibility with a Set of Type-1 Edges}
\begin{defn}
    Let $\Ar 
    %= \{ \ed {L}{X_L}{Y_L} \}%
    %_{L \in \mathrm{Labels}}
    $ be a collection of type-1 arcs. 
    A joint distribution $\mu(\mat X)$ may be ``qualitatively compatible'' with $\Ar$ 
    in a couple of different senses; concretely, $\mu$ is said to be:
    \begin{enumerate}[label=\textbullet~\textit{q\arabic*-compatible} with $\Ar$ iff, labelwidth=-10em]
        % \item 
        \item for every pair of distinct edges $a_1, a_2 \in \Ar$, 
        we have that
        \[
            \Tgt {a_1} \underset\mu\CI \Tgt {a_2} ~\Big|~ \Src {a_1} \cup \Src {a_2}
        \]
        \item for every pair of disjoint subsets of edges $A_1, A_2 \subset \Ar$, 
        we have that
        \[
            \Tgt {A_1} \underset\mu\CI \Tgt {A_2} ~\Big|~ \Src {A_1} \cup \Src {A_2}
        \]
        \item 
         % for every pair of disjoint subsets of edges $E_1, E_2 \subset \Ed$, 
         % for every subset of edges $E \subset \Ed$, 
         $\mu(\mat X)$ can be written as the marginal of an extended distribution $\nu(\mat X, \mat U)$ in which $\mat U = \{ U_a : a \in \Ar\}$, thought of as a collection of exogenous sources of randomness, contains a distinct variable $U_a$ for each arc $a$, and
         \begin{enumerate}[label=(\alph*)]
            \item $\nu(\mat X) = \mu(\mat X)$;
            \item $\nu(\mat U) = \prod_{a \in \Ar} \nu(U_a)$,
                i.e., the exogenous variables are all independent;
            \item $\H_\nu(\Tgt a \mid \Src a,\,U_a) = 0$,
                i.e., each edge target is a deterministic function of its source and 
                    associated exogenous randomness;
            \item $U_a$ and $\Src a$ are independent in $\nu$;
            \item $U_a$ is independent of $\mat N$ given $\Src a$ and $\Tgt a$. 
        \end{enumerate}
        
        \item % factorization
        $ 
            \mu(\mat X) \propto \smash{\prod_{a \in \Ar}}\, \mu( \Tgt a \mid \Src a)$, 
            i.e., $\mu$ factors along its edges. 
        Note that this obviously gives us the independencies we're looking for in the case of a Bayesian Network. 

        \item 
%joe0
% First, define a pair (\omega,u) to be consistent (where u is
% derandomization of all the relevant mechanisms) if for each mechanism f:
% X -> \Delta(Y), if Xω=x  and f_u(x) = y, then Yω=y.   
% That is, (\omega,u) is consistent if the values of the variables in
% \omega are as dictated by the derandomized functions in u.
% 
% A distribution \mu on \Omega is consistent with type-1 edges if there is
% a distribution \nu on U that makes all the relevant mechanisms
% independent and a distribution  p on \Omega x U such that (a) the
% support of p consists of only consistent pairs (as defined above), (b)
% the marginal of p on \Omega is \mu, and (c) the marginal of p on U is
% \nu.  
            
            % $\mu(\mat N)$ can be written as the marginal of an extended distribution $\nu(\mat N, U)$, where $U$ is a variable that ``de-randomizes'' every edge.
        there exists a variable $U$ and
        a extended distribution $\nu(\mat X, U)$ and
        a family of functions  
        $\{ f_a : \V\Src a \times \V U \to  \V\Tgt a\}_{a\in \Ar} $ such that
        \begin{enumerate}[label=(\alph*)]
            \item $\mu(\mat X) = \nu(\mat X)$;
            \item $(f_a, \nu(U))$ is a derandomization 
            % of $p\ssub a(Y|X)$ for every $a \in \Ar$;
            of $\mu(\Tgt a | \Src a)$ for every $a \in \Ar$;
            \item $\nu$ has support only on ``consistent pairs'' $(\omega, u) \in \V(\mat X \times U)$
            such that, for every edge $a \in \Ar$, 
            % if $\Src a \omega = s$, and $\Tgt a \omega = t$, then $f_u(\omega) = t$. 
            we have $f(\Src a \omega, u) = \Tgt a \omega$;
            \item
            % for every $a \in \Ar$, $s \in \V \Src a$, and $t \in \V\Tgt a$, 
            the events 
            \[ 
                \Big\{ \{ u \in \V U : f_a(s,u) = t \} 
                    ~\Big|~a \in \Ar,\, (s,t) \in \V(\Src a, \Tgt a) \Big\}
                    % \Big\}_{a \in \Ar,\, (s,t) \in \V(\Src a, \Tgt a)}
            \]
            are mutually independent according to $\nu(U)$. 
        \end{enumerate}

    \end{enumerate}
\end{defn}

% Note that q4-compatibility .


% \begin{claim}
%     \begin{enumerate}
%         \item $\mu$ is q1-compatible with $\Ed$ iff, for every distinct pair of edges in $\Ed$, there exist independent mechanisms along them in $\mu$.
%         % \item $\mu$ is q1-compatible with $\Ed$ iff, for every disjoint pair of subsets of edges in $\Ed$, $\mu$ admits independent mechanisms along the  both.
%     \end{enumerate}
% \end{claim}

\begin{example}
    \begin{enumerate}[label=\textbf{(\alph*)}]
    \item Suppose $\Ed = \{ \ed1{}X, ~ \ed2{}X \}$ consists of just two edges pointing to $X$.
        Since there is only one pair of distinct edges edges,
        $\mu$ is q1-compatible with $\Ed$ iff 
        \begin{align*}
            X \underset\mu\CI X \qquad\iff\qquad \mu(X) = \delta_x \text{ for some }x \in \V(X),
        \end{align*}
        since the only way for a random variable to be independent of itself is if it is deterministic. 
        Since there are only two edges, the criteria for q2-compatibility is the same in this example.
        
        A distirbution is q3-compatible with $\mu$ iff there is some $\nu(X, U_1, U_2) = \nu(U_1)\nu(U_2) \nu(X|U_1,U_2)$ such that $\mu(X) = \nu(X)$, and $X$ is determined by $U_1$ and also by $U_2$. But the only way this is possible is again if $X$ is deterministic. So the q3-compatible distributions here are again the same.
        
    \item By the same logic as the first half above, $\mu$ is q1/q2-compatible with $\{ \to\! X, ~Y \!\gets \}$ iff
        % $\mu(X,Y) = \mu(X)\mu(Y)$.                
        $X \CI_\mu Y$. 
        
    Next, $\mu$ is q3-compatible with these edges if it is the marginal on $X,Y$ of some $\nu(X,Y,U_1, U_2) = \nu(U_1)\nu(U_2) \nu(X,Y|U_1,U_2)$ such that $X$ is a function of $U_1$,  $Y$ is a function of $U_2$, $U_1 \CI Y \mid X$, and $U_2 \CI X \mid Y$. 
    The fact that $U_1$ and $U_2$ are independent means $X = f(U_1)$ and $Y = g(U_2)$ are independent, and the last two conditions can be easily satisfied in a way that does not place any constraints on the marginal $\nu(X,Y) = \mu$. 
    So again q3-compatibility picks out the same set of distributions.

    \item Generalizing the first example, 
    $\mu$ is q1/q2-compatible with 
    $\Ed = \{ \ed1{X\!}{\!Y}, ~ \ed2{X\!}{\!Y} \}$ 
    % $\Ed = [  ] 
    consisting of two parallel edges iff
    \begin{align*}
        Y \underset\mu\CI Y \mid X \qquad
        &\iff\qquad \mu(Y, Y, X) \mu(X) = \mu(Y, X)\mu(Y,X)
        % \\&\iff\qquad \mu(X) = \mu(Y,X) \text{ or } \mu(X,Y) = 0
        \\&\iff\qquad \mu(X,Y) \in \{\mu(X), 0\}
        \\&\iff\qquad\text{the value of $Y$ is fully determined by $X$ in $\mu$}
        \\&\iff\qquad \H_{\mu}(Y|X) = 0            
        \qedhere
    \end{align*}
    \end{enumerate}
\end{example}


\begin{example}
    Consider $\Ed = \{ \ed 1{}{\!X},~ \ed2{Y\!}{\!X} \}$.
    A distribution $\mu$ is q1/q2-compatible with $\Ed$ iff
    \[
        X \underset\mu\CI X \mid Y \quad\iff\quad \text{$X$ is a function of $Y$}
        \quad\iff\quad \H_\mu(X|Y) = 0
        \qedhere
    \] 
\end{example}


% Now we'll focus on q5-compatibility.
% \begin{example}
% $\mu$ is q5-compatible with:
% \begin{enumerate}
%     \item the empty set of edges, iff $\mu(\mat N) \le 1$ which is true for all $\mu$. So all $\mu$ are compatible with it.
% 
%     \item No distributions 
% \end{enumerate}
% \end{example}


\begin{remark}
    From the above, we can see that neither q1 nor q2 compatibility distinguishes between the qualitative PDGs
    \vspace{-2ex}
    \[
        \begin{tikzpicture}[center base]
            \node[dpad0] (X) {$X$};
            \node[dpad0,right=0.6 of X] (Y) {$Y$};
            \draw[arr2] (X) -- (Y);
            \draw[arr2, <-] (Y) -- ++(1, 0);
        \end{tikzpicture}
        \quad~ \text{and}\qquad
        \begin{tikzpicture}[center base]
            \node[dpad0] (X) {$X$};
            \node[dpad0,right=0.6 of X] (Y) {$Y$};
            \draw[arr2] (X) to[bend left] (Y);
            \draw[arr2] (X) to[bend right] (Y);
        \end{tikzpicture}
        ~.
    \]
\end{remark}

% Next, we'll see two examples which separate q1- and q2-compatibility.
Next, we'll explore some issues with our definitions, and provide some examples that separate them from one another.

\begin{example}
    Consider the distribution $\mu(X,Y,Z)$, in which $X$ and $Y$ represent independent fair coin tosses, and $Z := X \oplus Y$.
    In this distribution, every pair of variables is independent, but not when conditioned on the value of the third.
    
    We claim that $\mu$ is q1-compatible with $\Ed = \{ \ed1{}X, ~ \ed2{}Y, ~ \ed3{}Z \}$---to see this, simply note that every pair of targets is independent. This is strange, because these edges suggest that the mechanisms defining $X$ $Y$ and $Z$ are all accounted for and independent. 
    
    However, $\mu$ is not q2-compatible with $\Ed$, because, for instance,
    $\Src {\{1,2\}} = \{X,Y\}$ are not independent of $Z = \Src {\{3\}}$ in $\mu$.
    It is also not q3-compatible with $\Ed$, because each variable would need to be a function of its associated exogenous variable, which factor as an independent product of three distributions. 
\end{example}

% \begin{example}
%     A joint distribution $\mu$ is  q-compatible with the edges of a BN iff
%     \begin{align*}
% 
%     \end{align*}
% \end{example}
\begin{prop}
    A joint distribution $\mu$ is q1-compatible with the edges corresponding to the structure of qualitative BN $\mathcal G$%
        \footnote{that is, the edges of the PDG $\PDGof{\mathcal B}$ for a BN $\mathcal B$}
    iff it satisfies the independencies of $\mathcal G$.
            % {\color{red} False!}
\end{prop}
\begin{proof}
    % {\color{red} False!}
    $(\implies)$. Suppose that $\mu$ satisfies the independencies of $\mathcal B$.
    Recall that in a BN structure, there is a 1-1 correspondence between hyper-edges $\Ed$ of $\cal B$ and the variables of $\cal B$. 
    So, let $X,Y$ be two variables of $\cal B$.
    
    To show that $\mu$ is q-compatible with $\Ed$, it suffices to show that 
    \[ X \underset\mu\CI  Y ~\Big|~ \Pa( X) \cup \Pa( Y)
        % \qquad\text{---which we do in the appendix}
        . \]
    % By RaU Thm 4.4.4 (CIRV3), it suffices to show
    % \[ \mat X \underset\mu\CI \mat Y \cup \Pa(\mat Y) ~\Big|~ \Pa(\mat X) \]
    This can be proved by appeal to d-separation. 
    Suppose, for contradiction, that $X$ and $Y$ are not d-separated given $\Pa( X)$ and $\Pa(Y)$,
     % i.e., there are variables $X \in \ X$ and $Y \in \mat Y$ that are d-connected given $\Pa(\mat X)$ and $\Pa(\mat Y)$.
    i.e., they are d-connected.
    By definition, this means that there is an undirected path (of edges of $\cal B$) that (1) cannot include parents of $X$ or $Y$ and (2) can only include head-to-head connections of directed edges $\cdots \to Z\gets \cdots$ at those nodes $Z$ which have a parent of $X$ or $Y$ descendent. 
    
    Now, because this path includes neither any parents of $X$ nor $Y$, the edges at the ends of the path must point inwards; the directions of the first and last edges must be: $X \to \cdots \gets Y$. 
    Such a path must necessarily have a head-to-head connection somewhere;
    %---let's call it $Z$---
    let's call $Z_1$ the node closest to $X$ at which this occurs, and analogously, let's call $Z_2$ the closest such node to $Y$.
    By the criteria for d-separatedness, every such node must have a parent of $X$ or $Y$ as a descendent (which we'll call $W_1$ and $W_2$ respectively, for $Z_1$ and $Z_2$). 
    % Without loss of generality, suppose it's a parent of $X$. 
    But this contradicts the fact that $\cal B$ is an acyclic graph! 
    
    Concretely, it must be the case that $W_1$ is not a parent of $X$ (so it is a parent of $Y$), and $W_2$ is not a parent of $Y$ (so it is a parent of $X$). 
    Because if $W_1$ were a parent of $X$, we would have a directed cycle 
    $W_1 \to X \to\cdots\to Z_1 \to \cdots \to W_1,$ 
    and if $W_2$ were a parent of $Y$, we would analogously have the directed cycle 
    $W_2 \to Y \to\cdots\to Z_2 \to \cdots\to W_2$. 
    But we're still in a bind; the only way to prevent this was to have edges $W_2 \to X$ and $W_1 \to Y$, creating the larger directed cycle
    \[
        W_2 \to X \to\!\cdots\!\to Z_1 \to\!\cdots\!\to W_1 \to Y \to\!\cdots\!\to Z_2 \to\!\cdots\!\to W_2.
    \]
    
    % Suppose that there is an undirected path from some $X \in \mat X$ to some $Y \in \mat Y$. Then

    
            
    $(\impliedby)$.
    Suppose that $\mu$ is 
    
    \TODO
    
\end{proof}

The analogous statement is not true for q2-compatibility.

\begin{prop}
    % There are distributions compatible with a
    It's not the case that every distribution satisfying the independencies of
    a qualitative BN $\cal B$ is also q2-compatible with the edges of $\PDGof{\cal B}$.
\end{prop}
\begin{proof}
    Counter-example:
    \begin{center}
    \begin{tikzcd}[column sep=1em,row sep=1.5ex]
        X_1 \to \cdots \ar[r] & Z \ar[d] & \ar[l] \cdots \gets Y \\
        & \vdots \ar[d] & \\
        X_2 & \ar[l] W
    \end{tikzcd}
    \end{center}
    % In the above BN, it's not the case that
    The above BN does not model the independence
    \(
        \{X_1, X_2\} \CI_{\cal B} Y ~\big|~ W.
    \)
    % But this independence is of the form 
\end{proof}


\begin{prop}
    A joint distribution $\mu$ is q5-compatible with the arcs $\Ar$ corresponding to the structure of a qualitative BN $\cal G$ iff it satisfies the independencies of $\cal G$. 
\end{prop}
\begin{proof}
    
\end{proof}

\section{Relationship to IDef}

\textbf{A Betting Game.} 
I think I can predict $Y$ from $X$ alone, at least to some degree.
How much should I bet that this is the case?

If I 


\begin{conj}
    A distribution $\mu$ is qualitatively compatible with the edges of an unweighted PDG $\dg N$ iff 
    % $\IDef{\dg N}(\mu) \succeq 0$. 
    the information profile vector of $\mu$ dominates the information profile vector of $\mu[\Ed]$. 
\end{conj}
\begin{conj}
    If $\mu$ 
\end{conj}
    
\end{document}
